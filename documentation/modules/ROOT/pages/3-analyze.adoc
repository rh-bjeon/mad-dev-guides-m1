= 3. 분석 - 25분
:imagesdir: ../assets/images

== 이 랩의 목표

이전 *평가* 단계에서 깨달으셨듯이, 이제 여러분은 레거시 애플리케이션을 분석해서 현대화의 관점에서 실제 코드 라인을 확인하고, 현대화 프로젝트에 필요한 시간과 노력을 추정할 수 있습니다.

이 연습의 목표는 MTA의 `분석(Analysis)` 기능을 사용하여 소스 코드와 속성을 스캔하여 _customers_ 애플리케이션을 분석하는 것입니다. 그런 다음 분석 보고서를 검토하고 실제 코드 수정을 시작합니다.

MTA _Analysis_ 는 조직에서 다음과 같은 목적으로 사용됩니다.

* 계획 및 작업 추정
* 마이그레이션 이슈 식별 및 솔루션 제공
* 자세한 리포팅

그리고 다음과 같은 여러 가지 기능을 갖추고 있습니다.

* 내장된 규칙 및 마이그레이션 경로
* 규칙 확장성 및 커스터마이징
* 소스 코드 또는 애플리케이션 아카이브를 분석하는 능력

자세한 내용은 https://access.redhat.com/documentation/en-us/migration_toolkit_for_applications/6.0/html-single/introduction_to_the_migration_toolkit_for_applications/index#new-mta-features_getting-started-guide[MTA 기능]에서 읽어보세요.

== 3.1. MTA를 사용하여 고객 애플리케이션 분석

먼저, MTA를 사용하여 인벤토리와 애플리케이션을 분석할 때 https://gitea.%SUBDOMAIN%/%USERID%/modern-app-dev[Gitea repository^] 링크를 참조하도록 *Git 저장소* 를 구성해야 합니다.

*Administration* 관점에서 *Repositories > Git* 을 선택합니다. *Consume insecure Git repositories* 스위치를 오른쪽으로 토글합니다.

image::mta-admin-git.png[admin git]

[NOTE]
====
다음 자격증명을 사용하여 Gitea 저장소에 로그인할 수도 있습니다.

* 사용자 이름 - `%USERID%`
* 비밀번호 - `{openshift-password}`
====

*Migration* 관점에서 `Application inventory` 페이지로 돌아갑니다. customers inventory에 대한 연필(edit) 아이콘을 클릭합니다.

다음 소스 코드 정보로 애플리케이션을 업데이트하세요.

* Repository type - `Git`
* Source Repository - `https://gitea.%SUBDOMAIN%/%USERID%/modern-app-dev.git`
* Branch - `ocp-4.15`
* Root path - `customers-tomcat-legacy`

image::application-update-git.png[application-update-git]

`Save` 를 선택하세요.

`Analysis` 탭을 선택합니다. `Customers` 애플리케이션을 클릭하면 `Analysis` 버튼이 활성화됩니다. 그런 다음 *Analyze* 를 클릭합니다.

image::application-analysis.png[application-analysis]

=== 3.1.1. 분석 모드

Analysis mode 팝업에서 `Source code` 를 선택합니다. 

image::add-applications.png[Add applications]

`Next` 를 클릭하세요.

=== 3.1.2. 타겟 설정

이제 변환 대상에 대한 옵션이 제공됩니다. 여기서는 우리가 이동하고 있는 기술에 따라 여러 대상을 선택합니다.

이것은 리눅스 컨테이너가 될 것이므로, Windows 파일시스템 경로가 있거나, 컨테이너 또는 리눅스에 친화적이지 않은 구성 등을 피하기 위해 건전성 검사를 하는 것이 합리적입니다. 또한 독점적인 JDK 배포판에 대한 의존성을 제거하기 위해 OpenJDK를 대상으로 선택할 것입니다.

따라서 대상으로 `Containers`, `Linux`, `OpenJDK` 를 클릭합니다.

image::configure-analysis-checked.png[Configure Analysis]

`Next` 를 클릭하세요.

종속성 범위로 `Application and internal dependencies only` (애플리케이션 및 내부 종속성만)을 선택합니다.

image::packages.png[Select packages]

`Next` 를 클릭하세요.

=== 3.1.3. 고급 옵션

Advanced 단계에서는 custom rules(사용자 지정 규칙)에 대한 옵션이 제공됩니다.

image::custom-rules.png[Custom rules]

MTA Analysis는 분석을 위해 사용자 정의 규칙 엔진을 사용합니다. 다양한 마이그레이션 경로를 지원하기 위해 기본적으로 많은 규칙이 제공되지만, 거기에 더 추가할 수도 있습니다. 사용자 정의 규칙은 매우 간단한 XML 구문으로 개발하여 분석의 일부로 사용할 수 있습니다. 우리는 Globex에서 과거에 사용되었던 특정 라이브러리의 사용을 감지하고 이를 제거하기 위해 수행해야 할 변경 사항에 대한 제안을 하는 몇 가지 사용자 정의 규칙을 제공합니다.

Gitea 저장소의 *customrules* 디렉토리에 있는 사용자 정의 규칙(`corporate-framework-config.windup.xml`)을 참조하려면 `Repository` 탭을 선택합니다.

repository 페이지에 다음 정보를 입력하세요.

* Repository type - `Git`
* Source Repository - `https://gitea.%SUBDOMAIN%/%USERID%/modern-app-dev.git`
* Branch - `ocp-4.15`
* Root path - `customrules`

[NOTE]
====
`Associated credentials` 에 `None` 이 표시되지 않은 경우, 해당 필드는 필수가 아니므로 그대로 두십시오.
====

image::add-repository-customrules.png[add-repository-customrules]

`Next` 를 클릭하세요.

다음으로, 분석을 미세 조정할 수 있는 옵션이 제공됩니다. 지금은 기본 옵션을 고수하겠습니다.

image::fine-tune.png[Fine tuning]

`Next` 를 클릭하세요.

마지막으로, 분석을 위한 구성 요약을 제공합니다.

image::finish-project.png[Finish project]

`Run` 을 클릭하세요. 그러면 MTA 작업 시스템이 OpenShift에 분석 파드를 할당하기 위한 리소스를 요청하는 동안 분석이 `Scheduled` 상태로 전환됩니다. MTA는 OpenShift의 리소스 관리 기능을 최대한 활용하여 배포된 프로젝트의 사용 가능한 리소스에 따라 분석을 확장합니다. 각 애플리케이션에 대한 개별 분석 파드가 생성되고(저희의 경우 하나) 사용 가능한 리소스가 있는 즉시 분석이 실행됩니다.

image::mta-application-analysis-scheduled.png[Analysis scheduled]

[NOTE]
====
분석을 실행하기 전에 분석기 엔진에 대한 컨테이너 이미지를 가져와야 하므로 분석을 시작하는 데 몇 분이 걸릴 수 있습니다.
====

이미지를 끌어오고 분석기 파드가 실행되면 분석 상태가 `In Progress` 로 변경됩니다. 애플리케이션 소스 코드가 현재 분석 중이며, 클러스터의 작업 부하에 따라 몇 분 더 걸릴 수 있습니다. 분석이 완료되면 상태가 `Completed` 로 변경됩니다.

== 3.2. 분석 결과 이해

애플리케이션 분석은 애플리케이션 자체의 여러 측면에 대한 통찰력을 제공하며, _Application Profile_ 을 통해 액세스할 수 있습니다. 분석이 완료되면(`Completed` 상태는 _Analysis_ 열에서 볼 수 있음) `Customers` 애플리케이션을 클릭하여 _Application Profile_ 을 엽니다.

=== 3.2.1. Effort

MTA는 소스 코드에서 발견된 각 문제 발생에 대한 개별 노력을 집계하여 특정 애플리케이션을 마이그레이션하는 데 필요한 노력을 결정하는 데 도움이 됩니다. 노력은 스토리 포인트로 표현되며, 이는 Agile 소프트웨어 개발에서 일반적으로 기능이나 변경을 구현하는 데 필요한 상대적인 노력 수준을 추정하는 데 사용되는 추상적인 지표입니다. Migration Toolkit for Application은 스토리 포인트를 사용하여 특정 애플리케이션 구성 요소와 애플리케이션 전체를 마이그레이션하는 데 필요한 노력 수준을 표현합니다. 각 조직에는 다른 팀과 기술이 있기 때문에 스토리 포인트와 작업 시간 간에는 직접적인 변환이 없지만 애플리케이션 마이그레이션이 얼마나 복잡한지 이해하는 비교적 방법을 제공합니다. 노력 수준은 마이그레이션할 애플리케이션의 크기와 복잡성에 따라 크게 달라집니다. 애플리케이션이 분석되면 `Effort` 지표가 _Application Inventory_ 테이블의 열과 _Application Profile_ 에서 보이게 됩니다.

image::mta-application-analysis-effort.png[Effort]

=== 3.2.2. Technology stack

분석을 통해 얻을 수 있는 첫 번째이자 가장 간단한 통찰력은 기술 스택을 식별하고 이를 태그로 _Application Profile_ 에 연결하는 것입니다. 그러면 나중에 이 정보를 활용하여 포트폴리오 전반에 걸쳐 자동으로 아키타입을 지정할 수 있습니다.

_Tags_ 탭을 클릭하여 `Customers` 애플리케이션과 관련된 태그를 탐색합니다. 이 탭은 _Application Profile_ 개념을 소개할 때 처음 탐색했을 때보다 훨씬 더 많은 태그를 보여줍니다. 이러한 태그는 분석을 실행하는 동안 식별할 수 있는 기술을 기반으로 분석기 엔진에서 자동으로 적용했습니다. 분석기에서 구체적으로 어떤 태그를 적용했는지 보려면 _Filter by_ 에서 `Source` 필터를 클릭하고 `Analysis` 를 선택합니다.

image::mta-application-analysis-tags.png[Analysis tags]

=== 3.2.3. Issues

MTA 전문 용어로 `Issues` 는 애플리케이션에서 발견되는 안티패턴으로, 특정 플랫폼에서 실행되지 못하게 할 수 있습니다. 종속성과 마찬가지로 MTA는 애플리케이션별로 개별적으로 문제를 탐색하거나 포트폴리오 수준에서 전역적으로 탐색할 수 있으므로 사용자는 특정 애플리케이션에 집중하거나 전체 애플리케이션 포트폴리오에서 트렌드를 식별할 수 있습니다. 특정 애플리케이션의 문제에 대한 바로가기는 _Application Profile_ 의 세부 정보 탭에서 찾을 수 있습니다.

`Customers` 애플리케이션을 클릭하여 _Application Profile_ 을 열고 `Issues` 를 클릭합니다. 그러면 `Issues` 뷰에서 `Single Application` 탭으로 이동하며, `Customers` 애플리케이션의 모든 문제를 표시하도록 필터가 미리 적용됩니다.

image::mta-application-analysis-issues.png[Issues]

목록에는 하드코딩된 IP 사용에 대한 직접 액세스가 포함되어 있으며, 이는 평가 중에 발견한 사항과 일치합니다. 이전에 지정한 사용자 지정 규칙도 트리거된 것으로 보입니다. 문제를 클릭하면 코드 조각, 외부 정보 링크 및 영향을 받은 파일 목록을 포함하여 해당 문제에 대한 자세한 정보를 얻을 수 있습니다.

`Issues` 표에서 `Hardcoded IP Address` 행을 확장하고 `Affected Files` 를 클릭합니다.

image::mta-application-analysis-issues-ip-files.png[Issues]

이 문제에 영향을 받은 파일 목록이 표시됩니다. 첫 번째 파일을 클릭하면 모달 창이 열리고 문제가 발견된 정확한 코드 조각과 해결 방법에 대한 설명을 포함한 추가 세부 정보가 표시됩니다.

image::mta-application-analysis-issues-ip-snippet.png[Issues]

분석기는 실제로 정적 IP를 찾았지만, 이는 properties 파일에서 나온 것이므로, 예를 들어 여기에서 액세스하는 자산인 데이터베이스가 원래 위치인 OpenShift 외부에 남아 있다면 그렇게 큰 문제로 간주해서는 안 됩니다. 모달 창과 `Affected Files` 탭을 닫습니다.

이제 `File system - Java IO` 행을 확장합니다. 이는 custom corporate configuration library의 사용 여부를 확인하는 사용자 정의 규칙의 트리거에 해당합니다. `View affected files` 를 클릭하여 해당 라이브러리의 사용이 얼마나 널리 퍼져 있는지 자세히 알아보세요.

image::mta-application-analysis-issues-config-files.png[Issues]

image::mta-application-analysis-issues-config-files-2.png[Issues]

`PersistenceConfig` 클래스만 이 문제의 영향을 받는 듯합니다. 클릭하여 자세히 알아보세요:

image::mta-application-analysis-issues-config-snippet1.png[Issues]

파일에서 동일한 문제가 *6* 번 발견된 것 같습니다. 모달 창에서 `All incident` 탭을 클릭하여 모든 문제를 확인하세요.

image::mta-application-analysis-issues-config-snippet2.png[Issues]

이는 분석기가 `PersistenceConfig` 클래스에서 두 번 사용되는 사용자 지정 구성 라이브러리의 `ApplicationConfiguration` 클래스를 찾았다는 것을 의미합니다. 사용법의 힌트에서 제공하는 가이드라인에 따라 이를 좀 더 표준적인 것으로 바꿔야 합니다. 이는 다음 모듈에서 다룰 내용입니다. 당장은 모든 모달을 닫고 _Application Inventory_ 뷰로 돌아가세요.

=== 3.2.4. Dependencies

MTA의 분석은 포트폴리오의 애플리케이션에서 사용하는 종속성에 대한 자세한 정보도 수집합니다. `Customers` 애플리케이션의 종속성 목록을 얻으려면 _Application Profile_ 을 열고 `Details` 탭에서 `Dependencies` 링크를 클릭합니다. 그러면 `Customers` 애플리케이션에 대한 필터가 미리 적용된 `Dependencies` 뷰로 이동합니다.

image::mta-application-analysis-dependencies.png[Issues]

종속성을 클릭하면 해당 종속성에 의존하는 포트폴리오의 각 애플리케이션과의 관계에 대한 추가 세부 정보가 제공됩니다. 여기에는 다음이 포함됩니다.

* Version of the dependency(종속성 버전), Maven Central에 대한 링크 포함.
* Management relationship(관리 관계), 관리 관계는 종속성이 Maven과 같은 종속성 관리자에 의해 관리되는지 아니면 단순히 바이너리에 내장되어 발견되었는지를 나타냅니다.
* Relationship(관계), 관계는 종속성이 직접적인지 전이적인지를 정의합니다.

== 요약

이제 레거시 애플리케이션을 성공적으로 분석하여 어떤 마이그레이션 문제가 있는지 알아냈습니다. 다음 모듈에서 애플리케이션을 리팩토링하여 문제를 해결합니다. 그런 다음 현대화된 애플리케이션을 Red Hat OpenShift에 배포합니다. 시작해 봅시다!